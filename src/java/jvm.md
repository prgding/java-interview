---
order: 2
---

# JVM

## JVM 运行流程

1. 类加载器加载 .class 文件
2. 链接：
    1. 验证：确保字节码安全、结构完整
    2. 准备：为类变量分配内存、初始化默认值
    3. 解析：将符号引用转为直接引用
3. 初始化：类初始化、静态代码块执行、类的全局变量赋值
4. 使用：执行主类的 main 方法
5. 类卸载

## 运行时数据区域

1. 线程共享：
    1. **堆**
        1. 保存对象实例、数组等
        2. 垃圾回收的主要区域
        3. 内存不够抛出异常 OutOfMemoryError
        4. （1.7）**方法区**：永久代：存储类信息、静态变量、常量池、方法字节码
2. 线程私有
    1. **栈**
        1. 虚拟机栈
        2. 本地方法栈
    2. **程序计数器**
3. 本地内存
    1. 直接内存
    2. （1.8）方法区：元空间：存储类信息、静态变量、常量池、方法字节码

## 垃圾回收机制

### 对象什么时候被回收

1. 对于引用计数法，对象的引用计数为 0 时被回收，但是难以解决循环引用问题。
2. 对于可达性分析法，当对象与 GC Roots 没有关联时会被回收。

### 垃圾回收算法

1. 标记 - 清除
    1. 使用可达性分析标记出存活对象，然后把其他的回收掉
    2. 缺点是会产生不连续的内存碎片
2. 复制
    1. 将内存分为两块，回收时将存活对象复制到另一块，然后把原来的空间清空。
    2. 缺点是内存缩小为原来的一半，且存活数量大时，复制性能差
3. 标记 - 整理
    1. 使用可达性分析标记存活
    2. 存活对象向一端移动，清理边界以外的内存